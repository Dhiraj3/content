commonfields:
  id: VirusTotal v3
  version: -1
name: VirusTotal v3
display: VirusTotal v3
fromversion: 5.5.0
category: Data Enrichment & Threat Intelligence
description: Analyze suspicious hashes, URLs, domains and IP addresses
configuration:
- display: API Key
  name: APIKey
  defaultvalue: ""
  type: 4
  required: true
- display: Use system proxy settings
  name: proxy
  defaultvalue: ''
  type: 8
  required: false
- display: Trust any certificate (not secure)
  name: insecure
  defaultvalue: ''
  type: 8
  required: false
- display: Is premium API?
  name: is_premium_api
  defaultvalue: 'false'
  type: 8
  required: false
- display: File Threshold. Minimum number of positive results from VT scanners to
    consider the file malicious.
  name: fileThreshold
  defaultvalue: "10"
  type: 0
  required: false
- display: IP Threshold. Minimum number of positive results from VT scanners to consider
    the IP malicious.
  name: ipThreshold
  defaultvalue: "10"
  type: 0
  required: false
- display: URL Threshold. Minimum number of positive results from VT scanners to consider
    the URL malicious.
  name: urlThreshold
  defaultvalue: "10"
  type: 0
  required: false
- display: Domain Threshold. Minimum number of positive results from VT scanners to
    consider the domain malicious.
  name: domainThreshold
  defaultvalue: "10"
  type: 0
  required: false
- display: Preferred Vendors List. CSV list of vendors which are considered more trustworthy.
  name: preferredVendors
  defaultvalue: ""
  type: 12
  required: false
- display: 'Preferred Vendor Threshold. The minimum number of highly trusted vendors
    required to consider a domain, IP address, URL, or file as malicious. '
  name: preferredVendorsThreshold
  defaultvalue: "5"
  type: 0
  required: false
- display: Whetever to enable score analyzing by Crowdsourced Yara Rules
  name: crowdsourced_yara_rules_enabled
  defaultvalue: 'true'
  type: 8
  required: false
- display: Crowdsourced Yara Rules Threshold
  name: yaraRulesThreshold
  defaultvalue: '1'
  type: 0
  required: false
- display: Sigma and Intrusion Detection Rules Threshold.
  name: SigmaIDSThreshold
  defaultvalue: '5'
  type: 0
  required: false
- display: Domain Popularity Ranking Threshold
  name: domain_popularity_ranking
  defaultvalue: '10000'
  type: 0
  required: false
- display: 'Premium Subscription Only: Relationship Files Threshold.'
  name: relashionship_threshold
  defaultvalue: '3'
  type: 0
  required: false
script:
  script: ''
  type: python
  subtype: python3
  commands:
  - name: file
    arguments:
    - name: file
      required: true
      default: true
      description: Hash of the file to query. Supports MD5, SHA1, and SHA256.
      isArray: false
    outputs:
    - contextPath: File.MD5
      description: Bad MD5 hash.
    - contextPath: File.SHA1
      description: Bad SHA1 hash.
    - contextPath: File.SHA256
      description: Bad SHA256 hash.
    - contextPath: File.Malicious.Vendor
      description: For malicious files, the vendor that made the decision.
    - contextPath: File.Malicious.Detections
      description: For malicious files, the total number of detections.
    - contextPath: File.Malicious.TotalEngines
      description: For malicious files, the total number of engines that checked the
        file hash.
    - contextPath: DBotScore.Indicator
      description: The indicator that was tested.
    - contextPath: DBotScore.Type
      description: The indicator type.
    - contextPath: DBotScore.Vendor
      description: The vendor used to calculate the score.
    - contextPath: DBotScore.Score
      description: The actual score.
    - contextPath: File.VirusTotal.Scans.Source
      description: Vendor used to scan the hash.
    - contextPath: File.VirusTotal.Scans.Detected
      description: Scan detection for this hash (True or False).
    - contextPath: File.VirusTotal.Scans.Result
      description: Scan result for this hash, for example, signature.
    - contextPath: File.VirusTotal.ScanID
      description: Scan ID for this hash.
      type: string
    - contextPath: File.PositiveDetections
      description: Number of engines that positively detected the indicator as malicious.
      type: number
    - contextPath: File.DetectionEngines
      description: Total number of engines that checked the indicator.
      type: number
    - contextPath: File.VirusTotal.vtLink
      description: Virus Total permanent link.
      type: string
    description: Checks the file reputation of the specified hash.
  - name: ip
    arguments:
    - name: ip
      required: true
      default: true
      description: IP address to check.
      isArray: false
    outputs:
    - contextPath: IP.Address
      description: Bad IP address.
    - contextPath: IP.ASN
      description: Bad IP ASN.
    - contextPath: IP.Geo.Country
      description: Bad IP country.
    - contextPath: IP.Malicious.Vendor
      description: For malicious IPs, the vendor that made the decision.
    - contextPath: IP.Malicious.Description
      description: For malicious IPs, the reason that the vendor made the decision.
    - contextPath: DBotScore.Indicator
      description: The indicator that was tested.
    - contextPath: DBotScore.Type
      description: The indicator type.
    - contextPath: DBotScore.Vendor
      description: The vendor used to calculate the score.
    - contextPath: DBotScore.Score
      description: The actual score.
    - contextPath: IP.VirusTotal.DownloadedHashes
      description: Latest files that were detected by at least one antivirus solution,
        and were downloaded by VirusTotal from the IP address.
    - contextPath: IP.VirusTotal.UnAVDetectedDownloadedHashes
      description: Latest files that were not detected by any antivirus solution,
        and were downloaded by VirusTotal from the specified IP address.
    - contextPath: IP.VirusTotal.DetectedURLs
      description: Latest URLs hosted in this IP address that were detected by at
        least one URL scanner.
    - contextPath: IP.VirusTotal.CommunicatingHashes
      description: Latest detected files that communicate with this IP address.
    - contextPath: IP.VirusTotal.UnAVDetectedCommunicatingHashes
      description: Latest undetected files that communicate with this IP address.
    - contextPath: IP.VirusTotal.Resolutions.hostname
      description: Domains that resolved to the specified IP address.
    - contextPath: IP.VirusTotal.ReferrerHashes
      description: Latest detected files that embed this IP address in their strings.
    - contextPath: IP.VirusTotal.UnAVDetectedReferrerHashes
      description: Latest undetected files that embed this IP address in their strings.
    - contextPath: IP.VirusTotal.Resolutions.last_resolved
      description: Last resolution times of the domains that resolved to the specified
        IP address.
    description: Checks the reputation of an IP address.
  - name: url
    arguments:
    - name: url
      required: true
      default: true
      description: URL to check.
      isArray: false
    outputs:
    - contextPath: URL.Data
      description: Bad URLs found.
    - contextPath: URL.Malicious.Vendor
      description: For malicious URLs, the vendor that made the decision.
    - contextPath: URL.Malicious.Description
      description: For malicious URLs, the reason that the vendor made the decision.
    - contextPath: DBotScore.Indicator
      description: The indicator that was tested.
    - contextPath: DBotScore.Type
      description: The indicator type.
    - contextPath: DBotScore.Vendor
      description: The vendor used to calculate the score.
    - contextPath: DBotScore.Score
      description: The actual score.
    - contextPath: URL.VirusTotal.Scans.Source
      description: Vendor that scanned this URL.
    - contextPath: URL.VirusTotal.Scans.Detected
      description: Scan detection for this URL (True or False).
    - contextPath: URL.VirusTotal.Scans.Result
      description: Scan result for this URL, for example, signature.
    - contextPath: URL.DetectionEngines
      description: Total number of engines that checked the indicator.
      type: number
    - contextPath: URL.PositiveDetections
      description: Number of engines that positively detected the indicator as malicious.
      type: number
    - contextPath: url.VirusTotal.ScanID
      description: Scan ID for this URL.
      type: string
    - contextPath: File.VirusTotal.vtLink
      description: Virus Total permanent link.
      type: string
    description: Checks the reputation of a URL.
  - name: domain
    arguments:
    - name: domain
      required: true
      default: true
      description: Domain name to check.
      isArray: false
    outputs:
    - contextPath: Domain.Name
      description: Bad domain found.
    - contextPath: Domain.Malicious.Vendor
      description: For malicious domains, the vendor that made the decision.
    - contextPath: Domain.Malicious.Description
      description: For malicious domains, the reason that the vendor made the decision.
    - contextPath: DBotScore.Indicator
      description: The indicator that was tested.
    - contextPath: DBotScore.Type
      description: The indicator type.
    - contextPath: DBotScore.Vendor
      description: The vendor used to calculate the score.
    - contextPath: DBotScore.Score
      description: The actual score.
    - contextPath: Domain.VirusTotal.DownloadedHashes
      description: Hashes of files that were downloaded from this domain.
    - contextPath: Domain.VirusTotal.CommunicatingHashes
      description: Hashes of files that communicated with this domain in a sandbox.
    - contextPath: Domain.VirusTotal.Resolutions.ip_address
      description: IP addresses that resolved to this domain.
    - contextPath: Domain.VirusTotal.Whois
      description: Whois report.
    - contextPath: Domain.VirusTotal.Subdomains
      description: Subdomains.
    - contextPath: Domain.VirusTotal.UnAVDetectedDownloadedHashes
      description: Latest files that were not detected by any antivirus solution,
        and were downloaded by VirusTotal from the specified IP address.
    - contextPath: Domain.VirusTotal.DetectedURLs
      description: Latest URLs hosted in this domain address that were detected by
        at least one URL scanner.
    - contextPath: Domain.VirusTotal.ReferrerHashes
      description: Latest detected files that embed this domain address in their strings.
    - contextPath: Domain.VirusTotal.UnAVDetectedReferrerHashes
      description: Latest undetected files that embed this domain address in their
        strings.
    - contextPath: Domain.VirusTotal.UnAVDetectedCommunicatingHashes
      description: Latest undetected files that communicated with this domain in a
        sandbox.
    - contextPath: Domain.VirusTotal.Resolutions.last_resolved
      description: Last resolution times of the IP addresses that resolve to this
        domain.
    description: Checks the reputation of a domain.
  - name: file-scan
    deprecated: true
    arguments:
    - name: entryID
      required: true
      default: true
      description: The file entry ID to submit.
    - name: uploadURL
      description: Private API extension. Special upload URL for files larger than
        32 MB.
    description: Submits a file for scanning.
  - name: vt-file-scan
    arguments:
    - name: entryID
      required: true
      default: true
      description: The file entry ID to submit.
    - name: uploadURL
      description: Private API extension. Special upload URL for files larger than
        32 MB.
    outputs:
    - contextPath: vtScanID
      description: Scan IDs of the submitted files.
    - contextPath: vtLink
      description: Virus Total permanent link.
      type: string
    description: Submits a file for scanning.
  - name: file-rescan
    deprecated: true
    arguments:
    - name: file
      required: true
      default: true
      description: Hash of the file to re-scan. Supports MD5, SHA1, and SHA256.
    description: Re-scans an already submitted file. This avoids having to upload
      the file again.
  - name: vt-file-rescan
    arguments:
    - name: file
      required: true
      default: true
      description: Hash of the file to re-scan. Supports MD5, SHA1, and SHA256.
    outputs:
    - contextPath: vtScanID
      description: Scan IDs of the submitted files.
    - contextPath: vtLink
      description: Virus Total permanent link.
      type: string
    description: Re-scans an already submitted file. This avoids having to upload
      the file again.
  - name: vt-url-scan
    arguments:
    - name: url
      required: true
      default: true
      description: The URL to scan.
    outputs:
    - contextPath: vtScanID
      description: Scan IDs of the submitted URLs.
    description: Scans a specified URL.
  - name: url-scan
    deprecated: true
    arguments:
    - name: url
      required: true
      default: true
      description: The URL to scan.
    outputs:
    - contextPath: vtScanID
      description: Scan IDs of the submitted URLs.
    description: Scans a specified URL.
  - name: vt-comments-add
    arguments:
    - name: resource
      required: true
      default: false
      description: The file hash, url, ip or domain you're commenting on.
    - name: resource_type
      required: true
      default: false
      description: The type of the resource you're commenting one.
      auto: PREDEFINED
      predefined:
      - ip
      - url
      - domain
      - hash
    - name: comment
      required: true
      description: 'The actual review, which you can tag by using the "#" twitter-like
        syntax, for example, #disinfection #zbot, and reference users using the "@"
        syntax, for example, @VirusTotalTeam).'
    description: Adds comments to files and URLs.
  - name: vt-file-scan-upload-url
    arguments: []
    outputs:
    - contextPath: VirusTotal.FileUploadURL
      description: The special upload URL for large files.
    description: Private API. Get a special URL for files larger than 32 MB.
  - name: vt-comments-get
    arguments:
    - name: resource
      required: true
      default: false
      description: The file hash (MD5, SHA1, orSHA256) or URL from which you're retrieving
        comments.
    - name: resource_type
      required: true
      default: false
      description: The type of the resource you're commenting one.
      auto: PREDEFINED
      predefined:
      - ip
      - url
      - domain
      - hash
    - name: limit
      description: Maximum comments to fetch
      defaultValue: 10
    description: Retrieves comments for a given resource.
  - name: vt-comments-get-by-id
    arguments:
    - name: id
      required: true
      default: true
      description: The comment's id. Can be retrieved from vt-comments-get.
    description: Retrieves a comment by comment ID.
  - name: vt-search
    description: Search for an indicator in Virus Total.
    arguments:
    - name: query
      required: true
      default: true
      description: 'This endpoint searches any of the following: A file hash, A URL,
        A domain, A IP address, Tag comments.'
  - name: vt-file-sandbox-report
    arguments:
    - name: file
      required: true
      default: true
      description: Hash of the file to query. Supports MD5, SHA1, and SHA256.
    - name: limit
      description: Maximum results to fetch.
      defaultValue: 10
    description: Retrives a behavioural relationship of the given file hash.
  - name: vt-ip-passive-dns-data
    description: Returns passive DNS records by indicator.
    arguments:
    - name: ip
      required: true
      default: true
      description: IP to get its DNS data.
    - name: limit
      description: Maximum results to fetch.
      defaultValue: 10
  - name: vt-analysis-get
    arguments:
    - name: id
      required: true
      default: true
      description: ID of the analysis (from vt-file-scan, vt-file-rescan or vt-url-scan)
    description: Retrives resolutions of the given ip.
  runonce: false
  dockerimage: demisto/python3:3.9.1.15759
tests:
- VirusTotal-V3-test-playbook
