commonfields:
  id: script-JiraListTransition
  version: -1
name: script-JiraListTransition
script: |-
  def create_output(error_msg):
      return {"Type": entryTypes["error"], "ContentsFormat": formats["text"],
                                    "Contents": error_msg, "HumanReadable": error_msg, "ReadableContentsFormat": formats["text"]}
  def main():
      output = {}
      try:
          incident = demisto.incidents()[0]
          incident_id = demisto.incidents()[0].get('dbotMirrorId')
          if incident_id:
              res = demisto.executeCommand('jira-list-transitions', {'issueId': incident.get('dbotMirrorId')})
              if res and isinstance(res, list):
                  transitions_names = res[0].get("Contents")
                  if transitions_names:
                      if not isError(res):
                          output = {'hidden': False, 'options': sorted(transitions_names)}
                      else:
                          output = create_output(f"Error occurred while running jira-list-transitions. The response is: {transitions_names}")
                  else:
                      output = create_output(f"Error occurred while running script-JiraListTransition. Could not find:\"Content\" as key. The response is: {res}")
              else:
                  output = create_output(f"Error occurred while running script-JiraListTransition. expected a list as response but got: {type(res)}. The response is: {res}")
          else:
              output = create_output(f"Error occurred while running script-JiraListTransition because could not get \"dbotMirrorId\" from incident.")
      except Exception as ex:
          output = create_output("Error occurred while running script-JiraListTransition. got the next error:\n" + str(ex))
      finally:
          demisto.results(output)
  if __name__ in ["__main__", "builtin", "builtins"]:
      main()
type: python
tags:
- field-display
enabled: true
scripttarget: 0
subtype: python3
runonce: false
dockerimage: demisto/python3:3.9.1.15759
fromversion: 5.0.0
comment: |-
  This script lists all possible transitions for a given issue.
runas: DBotWeakRole
tests:
- Jira-v2-Test
